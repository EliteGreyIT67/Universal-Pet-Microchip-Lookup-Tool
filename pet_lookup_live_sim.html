<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Pet Microchip Lookup Tool (Conceptual Live Demo)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for better visual feedback */
        .result-card {
            @apply bg-white p-6 rounded-lg shadow-lg mb-6 transition-all duration-300 ease-in-out;
        }
        .result-card h3 {
            @apply text-xl font-semibold mb-2 text-indigo-600;
        }
        .result-card p {
            @apply text-gray-700 mb-1;
        }
        .result-card a {
            @apply text-blue-500 hover:text-blue-700 underline;
        }
        .note {
            @apply mt-2 p-3 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-md text-sm;
        }
        .error-message {
            @apply mt-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md;
        }
        .info-message {
            @apply mt-4 p-4 bg-blue-100 border-l-4 border-blue-500 text-blue-700 rounded-md;
        }
        .loading-spinner {
            @apply animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mr-2;
        }
        .live-lookup-section h4 {
            @apply text-lg font-semibold mb-3 text-green-700;
        }
        .live-lookup-item {
            @apply p-3 mb-2 border border-gray-200 rounded-md bg-gray-50;
        }
        .live-lookup-item strong {
            @apply text-gray-800;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="container mx-auto max-w-2xl bg-white p-8 rounded-xl shadow-2xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-700">Universal Pet Microchip Lookup</h1>
            <p class="text-gray-600 mt-2">Identify potential microchip manufacturers and simulate live registration checks.</p>
            <div class="mt-2 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md text-sm">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <strong>Disclaimer:</strong> This tool suggests manufacturers based on prefixes. The "Live Registration Status" is a simulation and DOES NOT query real databases.
            </div>
        </header>

        <div class="mb-6">
            <label for="microchipNumber" class="block text-sm font-medium text-gray-700 mb-1">Enter Microchip Number:</label>
            <div class="flex">
                <input type="text" id="microchipNumber" name="microchipNumber" class="mt-1 block w-full rounded-l-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-3" placeholder="e.g., 985121000000000">
                <button id="lookupButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-r-md transition-colors duration-150 ease-in-out">
                    <i class="fas fa-search mr-2"></i>Lookup
                </button>
            </div>
        </div>

        <div id="results" class="mt-6">
            </div>

        <div id="live-registration-results-container" class="mt-8 hidden">
            </div>

        <div id="critical-next-steps" class="mt-8 hidden p-4 bg-green-50 border-l-4 border-green-500 rounded-md">
             <h3 class="text-xl font-semibold mb-2 text-green-700"><i class="fas fa-check-circle mr-2"></i>Critical Next Steps</h3>
             <p class="text-green-800 mb-2">Identifying the manufacturer is only the first step. To find the owner, you MUST use comprehensive pet recovery services:</p>
             <ul class="list-disc list-inside text-green-800 space-y-1">
                 <li><strong>AAHA Universal Pet Microchip Lookup:</strong> <a href="http://www.petmicrochiplookup.org" target="_blank" class="hover:underline">www.petmicrochiplookup.org</a> (Most crucial)</li>
                 <li><strong>PetChip.info:</strong> <a href="https://www.petchip.info/" target="_blank" class="hover:underline">www.petchip.info</a> (Check if not found on AAHA)</li>
                 <li><strong>International Databases:</strong> Consider Europetnet or PetMaxx if the chip seems international.</li>
             </ul>
        </div>

    </div>

    <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-50">
        <div class="relative mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div id="modalIcon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-3">
                     <i class="fas fa-times-circle text-red-600 text-2xl"></i>
                </div>
                <h3 id="modalTitle" class="text-lg leading-6 font-medium text-gray-900">Error</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="modalMessage" class="text-sm text-gray-500">An error occurred.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="closeModalButton" class="px-4 py-2 bg-indigo-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- Mock Microchip Data (simulating microchip_data.json) ---
        const microchipData = {
            "prefixes": [
                { "prefix": "985", "company": "Datamars / PetLink", "notes": "Commonly PetLink, also other brands. 15 digits.", "phone": "877-738-5465", "web": "www.petlink.net" },
                { "prefix": "9810", "company": "AVID (US)", "notes": "10-digit AVID chips often start 9810. May also be 9-digit.", "phone": "800-336-2843", "web": "www.avidid.com" },
                { "prefix": "900", "company": "AKC Reunite / EIDAP", "notes": "Can be AKC Reunite or other EIDAP brands. 15 digits.", "phone": "800-252-7894", "web": "www.akcreunite.org" },
                { "prefix": "TEST", "company": "Test Chip Inc.", "notes": "This is a known test chip pattern.", "phone": "N/A", "web": "N/A", "isTestChip": true }
            ],
            "shared_codes": {
                "977": "Used by multiple smaller companies. Check AAHA."
            },
            "no_prefix_match_guidance": "No specific manufacturer prefix matched. This could be an international chip (check ISO country codes), a newer/rarer chip, or a typo. ALWAYS use AAHA Universal Lookup (petmicrochiplookup.org) and PetChip.info to search registration databases."
        };

        // --- DOM Elements ---
        const microchipInput = document.getElementById('microchipNumber');
        const lookupButton = document.getElementById('lookupButton');
        const resultsDiv = document.getElementById('results');
        const liveResultsContainer = document.getElementById('live-registration-results-container');
        const criticalNextStepsDiv = document.getElementById('critical-next-steps');
        
        // Modal elements
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalIcon = document.getElementById('modalIcon');
        const closeModalButton = document.getElementById('closeModalButton');

        // --- Event Listeners ---
        lookupButton.addEventListener('click', handleLookup);
        microchipInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                handleLookup();
            }
        });
        closeModalButton.addEventListener('click', () => {
            messageModal.classList.add('hidden');
        });

        // --- Functions ---
        function showModal(title, message, isError = true) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            if (isError) {
                modalIcon.innerHTML = '<i class="fas fa-times-circle text-red-600 text-2xl"></i>';
                modalIcon.classList.remove('bg-green-100');
                modalIcon.classList.add('bg-red-100');
            } else {
                modalIcon.innerHTML = '<i class="fas fa-check-circle text-green-600 text-2xl"></i>';
                modalIcon.classList.remove('bg-red-100');
                modalIcon.classList.add('bg-green-100');
            }
            messageModal.classList.remove('hidden');
        }

        function sanitizeInput(chipNumber) {
            return chipNumber.replace(/[\s\-\*]/g, '').toUpperCase();
        }

        function handleLookup() {
            const rawChipNumber = microchipInput.value;
            if (!rawChipNumber.trim()) {
                showModal('Input Error', 'Please enter a microchip number.');
                return;
            }
            const chipNumber = sanitizeInput(rawChipNumber);
            resultsDiv.innerHTML = ''; // Clear previous manufacturer results
            liveResultsContainer.innerHTML = ''; // Clear previous live results
            liveResultsContainer.classList.add('hidden');
            criticalNextStepsDiv.classList.add('hidden');


            // Display a loading indicator for manufacturer lookup
            resultsDiv.innerHTML = `
                <div class="flex items-center justify-center result-card">
                    <div class="loading-spinner"></div>
                    <p>Looking up manufacturer...</p>
                </div>`;
            
            // Simulate fetching manufacturer data (as if from an external JSON file)
            setTimeout(() => {
                lookupManufacturer(chipNumber);
                // After manufacturer lookup, proceed to conceptual live registration check
                fetchConceptualLiveRegistrationStatus(chipNumber);
                criticalNextStepsDiv.classList.remove('hidden');
            }, 500); // Short delay to simulate data loading
        }

        function lookupManufacturer(chipNumber) {
            resultsDiv.innerHTML = ''; // Clear loading indicator

            let foundMatch = false;

            // Check for exact prefix matches (longer prefixes first for specificity)
            const sortedPrefixes = microchipData.prefixes.sort((a, b) => b.prefix.length - a.prefix.length);

            for (const entry of sortedPrefixes) {
                if (chipNumber.startsWith(entry.prefix)) {
                    displayManufacturerResult(entry, chipNumber);
                    foundMatch = true;
                    break; // Found the most specific match
                }
            }

            // Check shared codes if no specific prefix found yet
            if (!foundMatch) {
                for (const code in microchipData.shared_codes) {
                    if (chipNumber.startsWith(code)) {
                        const sharedEntry = {
                            company: `Potentially: ${microchipData.shared_codes[code]}`,
                            notes: `The prefix '${code}' is used by multiple companies. It's crucial to check comprehensive databases.`,
                            isShared: true
                        };
                        displayManufacturerResult(sharedEntry, chipNumber);
                        foundMatch = true;
                        break;
                    }
                }
            }
            
            if (!foundMatch) {
                resultsDiv.innerHTML = `
                    <div class="result-card">
                        <h3><i class="fas fa-question-circle mr-2 text-orange-500"></i>No Specific Manufacturer Prefix Matched</h3>
                        <p>${microchipData.no_prefix_match_guidance}</p>
                    </div>`;
            }
        }

        function displayManufacturerResult(entry, chipNumber) {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            let html = `<h3><i class="fas fa-microchip mr-2"></i>Potential Manufacturer: ${entry.company}</h3>`;
            if (entry.phone && entry.phone !== "N/A") {
                html += `<p><i class="fas fa-phone mr-2 text-gray-500"></i><strong>Phone:</strong> <a href="tel:${entry.phone}">${entry.phone}</a></p>`;
            }
            if (entry.web && entry.web !== "N/A") {
                html += `<p><i class="fas fa-globe mr-2 text-gray-500"></i><strong>Web:</strong> <a href="http://${entry.web}" target="_blank">${entry.web}</a></p>`;
            }
            if (entry.notes) {
                html += `<div class="note">${entry.isTestChip ? '<i class="fas fa-flask mr-1 text-red-600"></i><strong>Warning:</strong> ' : ''}${entry.notes}</div>`;
            }
            if (entry.isTestChip) {
                 card.classList.add('border-4', 'border-red-500');
            }
            card.innerHTML = html;
            resultsDiv.appendChild(card);
        }

        // --- NEW: Conceptual Live Registration Status ---
        function fetchConceptualLiveRegistrationStatus(chipNumber) {
            liveResultsContainer.classList.remove('hidden');
            liveResultsContainer.innerHTML = `
                <div class="result-card live-lookup-section">
                    <h4><i class="fas fa-sync-alt fa-spin mr-2"></i>Conceptual Live Registration Status</h4>
                    <div class="flex items-center justify-center p-4">
                        <div class="loading-spinner"></div>
                        <p>Simulating checks with major registration databases...</p>
                    </div>
                </div>`;

            // Simulate an API call delay
            setTimeout(() => {
                const mockResponses = simulateBackendApiCall(chipNumber);
                displayConceptualLiveResults(mockResponses);
            }, 1500); // Longer delay to simulate multiple API calls
        }

        function simulateBackendApiCall(chipNumber) {
            // This is where a real backend would query multiple databases.
            // We'll return mock data.
            const responses = [];

            // Mock AAHA Response
            if (chipNumber.includes("985") || chipNumber.length === 15) { // Example condition
                responses.push({
                    database: "AAHA Universal Lookup (PetMicrochipLookup.org)",
                    status: "Registered",
                    details: "PetLink (Datamars)",
                    registeredOn: "2022-08-15",
                    contact: "Contact PetLink at 877-738-5465 or visit www.petlink.net",
                    isPrimary: true
                });
            } else {
                 responses.push({
                    database: "AAHA Universal Lookup (PetMicrochipLookup.org)",
                    status: "Not Found / Not Participating",
                    details: "Chip not found in participating registries or registry does not participate with AAHA.",
                    isPrimary: true
                });
            }

            // Mock PetChip.info Response
            if (chipNumber.startsWith("9810") || Math.random() > 0.6) { // Example condition
                 responses.push({
                    database: "PetChip.info",
                    status: "Registered",
                    details: "AVID (US)",
                    registeredOn: "2021-03-10",
                    contact: "Contact AVID at 800-336-2843 or visit www.avidid.com"
                });
            } else {
                responses.push({
                    database: "PetChip.info",
                    status: "Not Found",
                    details: "Chip not found in this database."
                });
            }
            
            // Mock International Database Response
            if (chipNumber.startsWith("900") && chipNumber.length > 12 && Math.random() > 0.5) {
                 responses.push({
                    database: "Conceptual International Registry (e.g., Europetnet)",
                    status: "Registered",
                    details: "Registered internationally (e.g., via AKC Reunite).",
                    registeredOn: "2023-01-20",
                    contact: "Check Europetnet or PetMaxx for details."
                });
            }

            // Add a generic "not found" if no positive matches, for demonstration
            if (responses.filter(r => r.status === "Registered").length === 0 && responses.length < 3) {
                 responses.push({
                    database: "Other Sample Registry",
                    status: "Not Found",
                    details: "This is a placeholder for another registry check."
                });
            }


            return responses;
        }

        function displayConceptualLiveResults(responses) {
            liveResultsContainer.innerHTML = ''; // Clear loading

            const sectionCard = document.createElement('div');
            sectionCard.className = 'result-card live-lookup-section';
            
            let contentHtml = `<h4><i class="fas fa-database mr-2 text-green-600"></i>Conceptual Live Registration Status</h4>`;
            contentHtml += `<p class="text-sm text-gray-600 mb-3">Below are *simulated* results from querying major pet registration databases. <strong>This is not real data.</strong></p>`;

            if (responses.length === 0) {
                contentHtml += `<p class="info-message">No conceptual live lookup data to display for this simulation.</p>`;
            } else {
                responses.forEach(res => {
                    contentHtml += `
                        <div class="live-lookup-item ${res.status === 'Registered' ? 'bg-green-50 border-green-200' : (res.status.includes('Not Found') ? 'bg-yellow-50 border-yellow-200' : 'bg-gray-50')}">
                            <strong>${res.database}:</strong>
                            <span class="font-semibold ${res.status === 'Registered' ? 'text-green-700' : 'text-orange-600'}">${res.status}</span>
                            ${res.details ? `<p class="text-xs text-gray-600 mt-1"><em>Details:</em> ${res.details}</p>` : ''}
                            ${res.registeredOn ? `<p class="text-xs text-gray-600"><em>Registered On (Simulated):</em> ${res.registeredOn}</p>` : ''}
                            ${res.contact ? `<p class="text-xs text-gray-600"><em>Next Step (Simulated):</em> ${res.contact}</p>` : ''}
                        </div>`;
                });
            }
            sectionCard.innerHTML = contentHtml;
            liveResultsContainer.appendChild(sectionCard);
        }

    </script>
</body>
</html>

