<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Pet Microchip Lookup Tool (Enhanced Links & Copy)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Use Tailwind classes as much as possible, minimize @apply to rare customizations */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Accessibility: Improve focus states and outlines */
        button:focus, input:focus {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }
        /* Custom card and modal styling */
        .result-card {
            @apply bg-white p-6 rounded-lg shadow-lg mb-6 transition-all duration-300 ease-in-out;
        }
        .result-card h3 {
            @apply text-xl font-semibold mb-2 text-indigo-600;
        }
        .result-card p {
            @apply text-gray-700 mb-1;
        }
        .result-card a {
            @apply text-blue-500 hover:text-blue-700 underline;
        }
        .note {
            @apply mt-2 p-3 rounded-md text-sm;
        }
        .error-message {
            @apply mt-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md;
        }
        .info-message {
            @apply mt-4 p-4 bg-blue-100 border-l-4 border-blue-500 text-blue-700 rounded-md;
        }
        .loading-spinner {
            @apply animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mr-2;
        }
        .live-lookup-section h4 {
            @apply text-lg font-semibold mb-3 text-green-700;
        }
        .live-lookup-item {
            @apply p-3 mb-2 border rounded-md;
        }
        .live-lookup-item strong {
            @apply text-gray-800;
        }
        .critical-steps-list li {
            @apply mb-2 flex items-start;
        }
        .critical-steps-list i {
            @apply mr-2 mt-1 text-green-600;
        }
        .critical-steps-list a {
            @apply text-green-700 hover:text-green-900 font-medium;
        }
        #copyChipButton {
            @apply p-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-r-md transition-colors duration-150 ease-in-out border border-l-0 border-gray-300;
        }
        #copyMessage {
            @apply text-sm text-green-600 ml-2 opacity-0 transition-opacity duration-500;
        }
        @media (max-width: 640px) {
            .modal-content {
                width: 90vw !important;
                max-width: 100vw !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <main class="container mx-auto max-w-2xl bg-white p-8 rounded-xl shadow-2xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-700">Universal Pet Microchip Lookup</h1>
            <p class="text-gray-600 mt-2">Identify potential microchip manufacturers and simulate live registration checks with direct lookup links.</p>
            <div class="mt-2 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-md text-sm" role="alert">
                <i class="fas fa-exclamation-triangle mr-2" aria-hidden="true"></i>
                <strong>Disclaimer:</strong> This tool suggests manufacturers based on prefixes. The "Live Registration Status" is a simulation and DOES NOT query real databases. Always verify with real registries.
            </div>
        </header>

        <section class="mb-6" aria-labelledby="chip-input-label">
            <label id="chip-input-label" for="microchipNumber" class="block text-sm font-medium text-gray-700 mb-1">Enter Microchip Number:</label>
            <div class="flex items-center">
                <input type="text" id="microchipNumber" name="microchipNumber"
                       class="mt-1 block w-full rounded-l-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                       autocomplete="off" aria-label="Microchip Number" />
                <button type="button" id="copyChipButton" title="Copy Chip Number" class="mt-1" aria-label="Copy Chip Number">
                    <i class="fas fa-copy"></i>
                </button>
                <button type="button" id="lookupButton"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-r-md transition-colors duration-150 ease-in-out mt-1 ml-[-1px]"
                        aria-label="Lookup Microchip">
                    <i class="fas fa-search mr-2"></i>Lookup
                </button>
            </div>
            <span id="copyMessage" role="status">Chip number copied!</span>
        </section>

        <section id="results" class="mt-6" aria-live="polite"></section>

        <section id="live-registration-results-container" class="mt-8 hidden"></section>

        <section id="critical-next-steps" class="mt-8 hidden p-6 bg-green-50 border-l-4 border-green-500 rounded-md" aria-labelledby="critical-steps-title">
            <h2 id="critical-steps-title" class="text-xl font-semibold mb-3 text-green-700 flex items-center">
                <i class="fas fa-check-circle mr-2" aria-hidden="true"></i>Critical Next Steps: Find the Owner
            </h2>
            <p class="text-green-800 mb-3">
                Identifying the chip brand is only the first step. Use these resources to search actual registration databases. <strong>Check multiple sources if the first one fails.</strong>
            </p>
            <ul class="list-none critical-steps-list text-green-800 space-y-1">
                <li><i class="fas fa-star text-yellow-500"></i>
                    <div>
                        <strong>AAHA Universal Pet Microchip Lookup:</strong>
                        <a href="http://www.petmicrochiplookup.org" target="_blank" rel="noopener">PetMicrochipLookup.org</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>PetLink:</strong>
                        <a id="petlinkLookupLink" href="https://www.petlink.net/microchip-search/" target="_blank" rel="noopener">PetLink Search</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>HomeAgain:</strong>
                        <a id="homeagainLookupLink" href="https://www.homeagain.com/chip-lookup/" target="_blank" rel="noopener">HomeAgain Lookup</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>AKC Reunite:</strong>
                        <a id="akcLookupLink" href="https://www.akcreunite.org/microchip-lookup/" target="_blank" rel="noopener">AKC Lookup</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>Petkey:</strong>
                        <a id="petkeyLookupLink" href="https://petkey.org/Microchip/" target="_blank" rel="noopener">Petkey Search</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>BuddyID:</strong>
                        <a id="buddyidLookupLink" href="https://my.buddyid.com/results.php" target="_blank" rel="noopener">BuddyID Search</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>FreePetChipRegistry:</strong>
                        <a id="freepetchipLookupLink" href="https://www.freepetchipregistry.com/found-pet" target="_blank" rel="noopener">FreePetChipRegistry</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>SaveThisLife:</strong>
                        <a id="savethislifeLookupLink" href="https://www.savethislife.com/" target="_blank" rel="noopener">Save This Life</a>
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>Nanochip ID:</strong>
                        <a href="https://www.nanochipid.com/lookup/" target="_blank" rel="noopener">Nanochip ID Lookup</a> (May not participate in AAHA)
                    </div>
                </li>
                <li><i class="fas fa-link"></i>
                    <div>
                        <strong>Petstablished:</strong>
                        <a href="https://petstablished.com/microchip_lookup/" target="_blank" rel="noopener">Petstablished Lookup</a>
                    </div>
                </li>
                <li><i class="fas fa-globe-americas"></i>
                    <div>
                        <strong>PetChip.info:</strong>
                        <a href="https://www.petchip.info/" target="_blank" rel="noopener">www.petchip.info</a> (Good for international chips)
                    </div>
                </li>
                <li><i class="fas fa-globe-europe"></i>
                    <div>
                        <strong>International (if applicable):</strong>
                        Consider <a href="https://www.europetnet.com/" target="_blank" rel="noopener">Europetnet</a> or <a href="https://www.petmaxx.com/" target="_blank" rel="noopener">Petmaxx</a>
                    </div>
                </li>
            </ul>
        </section>
    </main>

    <!-- Modal for messages -->
    <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-50" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="relative mx-auto p-5 border w-96 shadow-lg rounded-md bg-white modal-content">
            <div class="mt-3 text-center">
                <div id="modalIcon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-3">
                    <i class="fas fa-times-circle text-red-600 text-2xl"></i>
                </div>
                <h3 id="modalTitle" class="text-lg leading-6 font-medium text-gray-900">Error</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="modalMessage" class="text-sm text-gray-500">An error occurred.</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="closeModalButton" class="px-4 py-2 bg-indigo-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300" aria-label="Close modal">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Mock Microchip Data (simulating microchip_data.json) ---
        const microchipData = {
            "prefixes": [
                { "prefix": "985", "company": "Datamars / PetLink", "notes": "Commonly PetLink. Also used by other brands. 15 digits. PetLink is a common registry.", "phone": "877-738-5465", "web": "www.petlink.net", "registry_search_url_template": "https://www.petlink.net/microchip-search/?microchip-number={chip_id}" },
                { "prefix": "9810", "company": "AVID (US)", "notes": "10-digit AVID chips often start 9810. May also be 9-digit. AVID has its own registry.", "phone": "800-336-2843", "web": "www.avidid.com", "registry_search_url_template": "https://www.avidid.com/pettrac/lookup/{chip_id}" },
                { "prefix": "900", "company": "AKC Reunite / EIDAP", "notes": "Can be AKC Reunite or other EIDAP brands. 15 digits. AKC Reunite is a common registry.", "phone": "800-252-7894", "web": "www.akcreunite.org", "registry_search_url_template": "https://www.akcreunite.org/microchip-lookup/?microchip_id={chip_id}" },
                { "prefix": "956", "company": "HomeAgain / Merck", "notes": "Often HomeAgain. 15 digits. HomeAgain is a major registry.", "phone": "888-466-3242", "web": "www.homeagain.com", "registry_search_url_template": "https://www.homeagain.com/chip-lookup/results?prevPage=chipLookup&chipNumber={chip_id}" },
                { "prefix": "933", "company": "BuddyID", "notes": "Often BuddyID / Microchip ID Systems. 15 digits.", "phone": "800-434-2843", "web": "www.buddyid.com", "registry_search_url_template": "https://my.buddyid.com/results.php?key={chip_id}" },
                { "prefix": "941", "company": "Save This Life", "notes": "Often Save This Life. 15 digits.", "phone": "855-777-2447", "web": "www.savethislife.com", "registry_search_url_template": "https://www.savethislife.com/search-microchips/?chip_num={chip_id}" },
                { "prefix": "TEST", "company": "Test Chip Inc.", "notes": "This is a known test chip pattern.", "phone": "N/A", "web": "N/A", "isTestChip": true }
            ],
            "shared_codes": {
                "977": "Used by multiple smaller companies. Check AAHA and other broad lookups."
            },
            "no_prefix_match_guidance": "No specific manufacturer prefix matched. This could be an international chip (check ISO country codes), a newer/rarer chip, or a typo. ALWAYS use AAHA Universal Lookup and try other links above."
        };

        // --- DOM Elements ---
        const microchipInput = document.getElementById('microchipNumber');
        const lookupButton = document.getElementById('lookupButton');
        const copyChipButton = document.getElementById('copyChipButton');
        const copyMessage = document.getElementById('copyMessage');
        const resultsDiv = document.getElementById('results');
        const liveResultsContainer = document.getElementById('live-registration-results-container');
        const criticalNextStepsDiv = document.getElementById('critical-next-steps');

        const petlinkLookupLink = document.getElementById('petlinkLookupLink');
        const homeagainLookupLink = document.getElementById('homeagainLookupLink');
        const akcLookupLink = document.getElementById('akcLookupLink');
        const petkeyLookupLink = document.getElementById('petkeyLookupLink');
        const buddyidLookupLink = document.getElementById('buddyidLookupLink');
        const freepetchipLookupLink = document.getElementById('freepetchipLookupLink');
        const savethislifeLookupLink = document.getElementById('savethislifeLookupLink');

        // Modal elements
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalIcon = document.getElementById('modalIcon');
        const closeModalButton = document.getElementById('closeModalButton');

        // --- Event Listeners ---
        lookupButton.addEventListener('click', handleLookup);
        microchipInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                handleLookup();
            }
        });
        closeModalButton.addEventListener('click', () => {
            messageModal.classList.add('hidden');
        });
        copyChipButton.addEventListener('click', copyChipNumberToClipboard);

        // --- Functions ---

        function showModal(title, message, isError = true) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            if (isError) {
                modalIcon.innerHTML = '<i class="fas fa-times-circle text-red-600 text-2xl"></i>';
                modalIcon.classList.remove('bg-green-100', 'text-green-600');
                modalIcon.classList.add('bg-red-100', 'text-red-600');
            } else {
                modalIcon.innerHTML = '<i class="fas fa-check-circle text-green-600 text-2xl"></i>';
                modalIcon.classList.remove('bg-red-100', 'text-red-600');
                modalIcon.classList.add('bg-green-100', 'text-green-600');
            }
            messageModal.classList.remove('hidden');
            closeModalButton.focus();
        }

        function sanitizeInput(chipNumber) {
            return chipNumber.replace(/[\s\-*]/g, '').toUpperCase();
        }

        function copyChipNumberToClipboard() {
            const chipNumber = sanitizeInput(microchipInput.value);
            if (!chipNumber) {
                showModal('Copy Error', 'Please enter a microchip number first.', true);
                return;
            }
            // Prefer modern Clipboard API if available
            if (navigator.clipboard) {
                navigator.clipboard.writeText(chipNumber).then(() => {
                    copyMessage.style.opacity = '1';
                    setTimeout(() => {
                        copyMessage.style.opacity = '0';
                    }, 2000);
                }).catch(err => {
                    showModal('Copy Error', 'Failed to copy chip number. Please copy manually.', true);
                    console.error('Clipboard API failed', err);
                });
            } else {
                // Fallback for older browsers
                const tempInput = document.createElement('input');
                tempInput.style.position = 'absolute';
                tempInput.style.left = '-9999px';
                tempInput.value = chipNumber;
                document.body.appendChild(tempInput);
                tempInput.select();
                try {
                    document.execCommand('copy');
                    copyMessage.style.opacity = '1';
                    setTimeout(() => {
                        copyMessage.style.opacity = '0';
                    }, 2000);
                } catch (err) {
                    showModal('Copy Error', 'Failed to copy chip number. Please copy manually.', true);
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(tempInput);
            }
        }

        function updateCriticalNextStepsLinks(chipId) {
            const chipParam = chipId ? encodeURIComponent(chipId) : '';
            petlinkLookupLink.href = `https://www.petlink.net/microchip-search/${chipParam ? '?microchip-number=' + chipParam : ''}`;
            homeagainLookupLink.href = `https://www.homeagain.com/chip-lookup/${chipParam ? 'results?prevPage=chipLookup&chipNumber=' + chipParam : ''}`;
            akcLookupLink.href = `https://www.akcreunite.org/microchip-lookup/${chipParam ? '?microchip_id=' + chipParam : ''}`;
            petkeyLookupLink.href = `https://petkey.org/Microchip/${chipParam ? '?m=' + chipParam : ''}`;
            buddyidLookupLink.href = `https://my.buddyid.com/results.php${chipParam ? '?key=' + chipParam : ''}`;
            freepetchipLookupLink.href = `https://www.freepetchipregistry.com/found-pet${chipParam ? '?chip=' + chipParam : ''}`;
            // SaveThisLife has a search page, but specific query param for direct result is less clear from main URL.
            savethislifeLookupLink.href = `https://www.savethislife.com/search-microchips/${chipParam ? '?chip_num=' + chipParam : ''}`;
        }

        function handleLookup() {
            const rawChipNumber = microchipInput.value;
            if (!rawChipNumber.trim()) {
                showModal('Input Error', 'Please enter a microchip number.');
                return;
            }
            const chipNumber = sanitizeInput(rawChipNumber);
            resultsDiv.innerHTML = '';
            liveResultsContainer.innerHTML = '';
            liveResultsContainer.classList.add('hidden');
            criticalNextStepsDiv.classList.add('hidden');
            updateCriticalNextStepsLinks(chipNumber);

            resultsDiv.innerHTML = `
                <div class="flex items-center justify-center result-card">
                    <div class="loading-spinner"></div>
                    <p>Looking up manufacturer...</p>
                </div>`;

            setTimeout(() => {
                const manufacturerInfo = lookupManufacturer(chipNumber);
                fetchConceptualLiveRegistrationStatus(chipNumber, manufacturerInfo);
                criticalNextStepsDiv.classList.remove('hidden');
            }, 500);
        }

        function lookupManufacturer(chipNumber) {
            resultsDiv.innerHTML = '';
            let foundMatch = null;

            // Sort by prefix length descending for longest-first match
            const sortedPrefixes = microchipData.prefixes.sort((a, b) => b.prefix.length - a.prefix.length);

            for (const entry of sortedPrefixes) {
                if (chipNumber.startsWith(entry.prefix)) {
                    displayManufacturerResult(entry, chipNumber);
                    foundMatch = entry;
                    break;
                }
            }

            if (!foundMatch) {
                for (const code in microchipData.shared_codes) {
                    if (chipNumber.startsWith(code)) {
                        const sharedEntry = {
                            company: `Potentially: ${microchipData.shared_codes[code]}`,
                            notes: `The prefix '${code}' is used by multiple companies. It's crucial to check comprehensive databases.`,
                            isShared: true
                        };
                        displayManufacturerResult(sharedEntry, chipNumber);
                        foundMatch = sharedEntry;
                        break;
                    }
                }
            }

            if (!foundMatch) {
                resultsDiv.innerHTML = `
                    <div class="result-card">
                        <h3><i class="fas fa-question-circle mr-2 text-orange-500"></i>No Specific Manufacturer Prefix Matched</h3>
                        <p>${microchipData.no_prefix_match_guidance}</p>
                    </div>`;
            }
            return foundMatch;
        }

        function displayManufacturerResult(entry, chipNumber) {
            const card = document.createElement('div');
            card.className = 'result-card';

            let html = `<h3><i class="fas fa-microchip mr-2"></i>Potential Manufacturer: ${entry.company}</h3>`;
            if (entry.phone && entry.phone !== "N/A") {
                html += `<p><i class="fas fa-phone mr-2 text-gray-500"></i><strong>Phone:</strong> <a href="tel:${entry.phone}">${entry.phone}</a></p>`;
            }
            if (entry.web && entry.web !== "N/A") {
                html += `<p><i class="fas fa-globe mr-2 text-gray-500"></i><strong>Web:</strong> <a href="http://${entry.web.startsWith('www.') ? entry.web : 'www.'+entry.web}" target="_blank">${entry.web}</a></p>`;
            }
            if (entry.notes) {
                const noteClass = entry.isTestChip ? 'border-red-500 bg-red-100 text-red-700' : 'border-yellow-500 bg-yellow-100 text-yellow-700';
                html += `<div class="note ${noteClass}">${entry.isTestChip ? '<i class="fas fa-flask mr-1"></i><strong>Warning:</strong> ' : ''}${entry.notes}</div>`;
            }
            if (entry.isTestChip) {
                card.classList.add('border-4', 'border-red-500');
            }
            card.innerHTML = html;
            resultsDiv.appendChild(card);
        }

        function fetchConceptualLiveRegistrationStatus(chipNumber, manufacturerInfo) {
            liveResultsContainer.classList.remove('hidden');
            liveResultsContainer.innerHTML = `
                <div class="result-card live-lookup-section">
                    <h4><i class="fas fa-sync-alt fa-spin mr-2"></i>Conceptual Live Registration Status</h4>
                    <div class="flex items-center justify-center p-4">
                        <div class="loading-spinner"></div>
                        <p>Simulating checks with major registration databases...</p>
                    </div>
                </div>`;

            setTimeout(() => {
                const mockResponses = simulateBackendApiCall(chipNumber, manufacturerInfo);
                displayConceptualLiveResults(mockResponses, chipNumber);
            }, 1500);
        }

        function simulateBackendApiCall(chipNumber, manufacturerInfo) {
            const responses = [];
            const chipIdEncoded = encodeURIComponent(chipNumber);

            // AAHA (Primary)
            responses.push({
                database: "AAHA Universal Lookup (PetMicrochipLookup.org)",
                status: manufacturerInfo ? "Registered (Potentially - Check AAHA)" : "Check AAHA",
                details: "AAHA searches many registries. Always start your search here.",
                isPrimary: true,
                lookupUrl: `http://www.petmicrochiplookup.org`
            });

            // Specific Manufacturer's Registry (if known and has a template)
            if (manufacturerInfo && manufacturerInfo.registry_search_url_template) {
                responses.push({
                    database: `${manufacturerInfo.company} Registry`,
                    status: "Check Directly (Recommended)",
                    details: `This chip may be registered with ${manufacturerInfo.company}. Use their direct lookup.`,
                    lookupUrl: manufacturerInfo.registry_search_url_template.replace("{chip_id}", chipIdEncoded)
                });
            }

            // Add other key registries
            const otherRegistries = [
                { name: "PetChip.info", urlTemplate: `https://www.petchip.info/search-decoded.aspx?microchipnumber={chip_id}`, note: "Good for some non-AAHA participating registries." },
                { name: "BuddyID", urlTemplate: `https://my.buddyid.com/results.php?key={chip_id}`, note: "Check BuddyID registry." },
                { name: "FreePetChipRegistry", urlTemplate: `https://www.freepetchipregistry.com/found-pet?chip={chip_id}`, note: "Also check this free registry." }
            ];

            otherRegistries.forEach(reg => {
                // Only add if not already covered by a specific manufacturer match that is the same company
                if (!manufacturerInfo || !manufacturerInfo.company?.toLowerCase().includes(reg.name.split('.')[0].toLowerCase())) {
                    if (Math.random() > 0.4 || (manufacturerInfo && manufacturerInfo.isShared)) {
                        responses.push({
                            database: reg.name,
                            status: "Potentially Registered (Check Directly)",
                            details: reg.note,
                            lookupUrl: reg.urlTemplate.replace("{chip_id}", chipIdEncoded)
                        });
                    }
                }
            });

            return responses;
        }

        function displayConceptualLiveResults(responses, chipNumber) {
            liveResultsContainer.innerHTML = '';

            const sectionCard = document.createElement('div');
            sectionCard.className = 'result-card live-lookup-section';

            let contentHtml = `<h4><i class="fas fa-database mr-2 text-green-600"></i>Conceptual Live Registration Status</h4>`;
            contentHtml += `<p class="text-sm text-gray-600 mb-3">Below are <em>simulated</em> results and direct links to query major pet registration databases with chip: <strong>${chipNumber}</strong></p>`;

            if (responses.length === 0) {
                contentHtml += `<p class="info-message">No conceptual live lookup data to display for this simulation.</p>`;
            } else {
                responses.forEach(res => {
                    let bgColor = 'bg-gray-50';
                    if (res.status.includes("Registered (Potentially") || res.status.includes("Check Directly")) bgColor = 'bg-blue-50 border-blue-300';
                    else if (res.status.includes("Check AAHA")) bgColor = 'bg-yellow-50 border-yellow-300';

                    contentHtml += `
                        <div class="live-lookup-item ${bgColor} border rounded-md">
                            <strong>${res.database}:</strong>
                            <span class="font-semibold ${res.status.includes('Registered') ? 'text-green-700' : (res.status.includes('Check AAHA') ? 'text-orange-600' : 'text-blue-700')}">${res.status}</span>
                            ${res.details ? `<p class="text-xs text-gray-600 mt-1"><em>Details:</em> ${res.details}</p>` : ''}
                            ${res.lookupUrl ? `<p class="text-xs text-gray-600 mt-1"><em>Action:</em> <a href="${res.lookupUrl.replace('{chip_id}', encodeURIComponent(chipNumber))}" target="_blank" rel="noopener" class="underline text-blue-700">Open Lookup</a></p>` : ''}
                        </div>`;
                });
            }
            sectionCard.innerHTML = contentHtml;
            liveResultsContainer.appendChild(sectionCard);
        }

        // Initialize links on load
        updateCriticalNextStepsLinks(null);
    </script>
</body>
</html>